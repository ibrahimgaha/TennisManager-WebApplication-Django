{% extends 'html/base.html' %} {% load static %} {% block title %}Admin
Dashboard - Tennis Club{% endblock %} {% block extra_css %}
<style>
  /* Modern Dashboard Styles - Compatible Version */
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
      "Helvetica Neue", Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    background-attachment: fixed;
    min-height: 100vh;
    margin: 0;
    padding: 0;
  }

  /* Modern Sidebar */
  .modern-sidebar {
    background: #ffffff;
    border-right: 1px solid #e3e6f0;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
    min-height: 100vh;
    position: relative;
  }

  .sidebar-header {
    padding: 2rem 1.5rem;
    border-bottom: 1px solid #e3e6f0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    position: relative;
  }

  .sidebar-header h6 {
    color: white;
    margin: 0;
    font-weight: 600;
  }

  .sidebar-header .text-muted {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.875rem;
  }

  .sidebar-header .d-flex {
    display: flex;
  }

  .sidebar-header .align-items-center {
    align-items: center;
  }

  .sidebar-header .mb-3 {
    margin-bottom: 1rem;
  }

  .sidebar-logo {
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: all 0.3s ease;
  }

  .sidebar-logo:hover {
    transform: scale(1.05);
    background: rgba(255, 255, 255, 0.3);
  }

  .sidebar-logo i {
    font-size: 1.5rem;
    color: white;
  }

  .ms-3 {
    margin-left: 1rem;
  }

  .sidebar-nav {
    padding: 16px 0;
    list-style: none;
    margin: 0;
  }

  .sidebar-nav .nav-item {
    margin: 0;
  }

  .sidebar-nav .nav-link {
    color: #5a5c69;
    padding: 1rem 1.5rem;
    margin: 0.25rem 1rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    text-decoration: none;
    font-weight: 500;
    cursor: pointer;
  }

  .sidebar-nav .nav-link:hover {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    transform: translateX(5px);
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  }

  .sidebar-nav .nav-link.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  }

  .sidebar-nav .nav-link i {
    font-size: 1.1rem;
    margin-right: 12px;
    width: 20px;
    text-align: center;
  }

  .sidebar-footer {
    position: absolute;
    bottom: 16px;
    left: 16px;
    right: 16px;
  }

  .btn-logout {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    border: none;
    color: white;
    padding: 12px;
    border-radius: 12px;
    font-weight: 500;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    cursor: pointer;
    font-size: 1rem;
  }

  .btn-logout:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
    color: white;
  }

  .btn-logout i {
    margin-right: 8px;
  }

  /* Main content adjustments */
  .main-content {
    background: #f8f9fc;
    min-height: 100vh;
    padding: 2rem;
  }

  /* Modern Card Styles */
  .card {
    border: none;
    border-radius: 0.75rem;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
    transition: all 0.3s ease;
    background: #ffffff;
    margin-bottom: 1.5rem;
    border-left: 0.25rem solid #667eea;
  }

  .card:hover {
    transform: translateY(-0.25rem);
    box-shadow: 0 0.25rem 2rem 0 rgba(58, 59, 69, 0.2);
  }

  .card-body {
    padding: 20px;
  }

  /* Bootstrap-like utilities */
  .d-flex {
    display: flex;
  }
  .align-items-center {
    align-items: center;
  }
  .mb-3 {
    margin-bottom: 1rem;
  }
  .fw-bold {
    font-weight: 600;
  }
  .text-dark {
    color: #333;
  }
  .text-muted {
    color: #6c757d;
  }
  .w-100 {
    width: 100%;
  }
  .position-sticky {
    position: sticky;
  }
  .pt-0 {
    padding-top: 0;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .modern-sidebar {
      position: fixed;
      top: 0;
      left: -100%;
      width: 280px;
      z-index: 1050;
      transition: left 0.3s ease;
    }

    .modern-sidebar.show {
      left: 0;
    }

    .sidebar-footer {
      position: relative;
      bottom: auto;
      margin-top: 32px;
    }

    .main-content {
      padding: 10px;
    }
  }

  /* Icons using Unicode symbols */
  .bi-shield-check::before {
    content: "üõ°Ô∏è";
  }
  .bi-speedometer2::before {
    content: "üìä";
  }
  .bi-people::before {
    content: "üë•";
  }
  .bi-grid-3x3-gap::before {
    content: "üèüÔ∏è";
  }
  .bi-person-badge::before {
    content: "üë®‚Äçüè´";
  }
  .bi-bar-chart::before {
    content: "üìà";
  }
  .bi-calendar-check::before {
    content: "üìÖ";
  }
  .bi-box-arrow-right::before {
    content: "üö™";
  }
  .bi-plus-circle::before {
    content: "‚ûï";
  }

  /* Modal Styles */
  .modal-content {
    border-radius: 15px;
    border: none;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  }

  .modal-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px 15px 0 0;
    border-bottom: none;
  }

  .modal-header .btn-close {
    filter: invert(1);
  }

  .modal-body {
    padding: 30px;
  }

  .form-control {
    border-radius: 8px;
    border: 2px solid #e9ecef;
    padding: 12px 15px;
    transition: all 0.3s ease;
  }

  .form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
  }

  /* Modern Dashboard Header */
  .dashboard-header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 24px 32px;
    margin-bottom: 32px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
  }

  .dashboard-title {
    font-size: 2.5rem;
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .title-icon {
    font-size: 2.5rem;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
  }

  .title-badge {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-left: 8px;
  }

  .dashboard-subtitle {
    color: #6b7280;
    font-size: 1.1rem;
    margin: 8px 0 0 0;
    font-weight: 500;
  }

  .header-actions {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  /* Modern Buttons */
  .btn-modern {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 16px;
    padding: 12px 24px;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    color: #4a5568;
  }

  .btn-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    background: rgba(255, 255, 255, 1);
    border-color: rgba(255, 255, 255, 0.4);
  }

  .btn-refresh {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
  }

  .btn-refresh:hover {
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
  }

  /* User Profile */
  .user-profile {
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    padding: 8px 16px;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .profile-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
  }

  .profile-info {
    display: flex;
    flex-direction: column;
  }

  .profile-name {
    font-weight: 600;
    color: #2d3748;
    font-size: 0.9rem;
  }

  .profile-role {
    font-size: 0.8rem;
    color: #6b7280;
  }

  .btn {
    border-radius: 16px;
    padding: 12px 24px;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: none;
  }

  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
  }

  /* Modern Stat Cards */
  .modern-stat-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 32px 24px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    margin-bottom: 24px;
  }

  .modern-stat-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(
      90deg,
      var(--card-color, #667eea) 0%,
      var(--card-color-end, #764ba2) 100%
    );
  }

  .modern-stat-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
  }

  .stat-card-primary {
    --card-color: #667eea;
    --card-color-end: #764ba2;
  }

  .stat-card-success {
    --card-color: #10b981;
    --card-color-end: #059669;
  }

  .stat-card-warning {
    --card-color: #f59e0b;
    --card-color-end: #d97706;
  }

  /* Recent Activity Styles */
  #recentActivity .border-bottom:last-child {
    border-bottom: none !important;
  }

  .activity-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .activity-item:hover {
    background-color: #f8f9fa;
    transition: background-color 0.2s ease;
  }

  .badge.bg-opacity-20 {
    --bs-bg-opacity: 0.2;
  }

  /* Scrollbar styling for activity list */
  #recentActivity::-webkit-scrollbar {
    width: 6px;
  }

  #recentActivity::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
  }

  #recentActivity::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
  }

  #recentActivity::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
  }

  /* Activity type icons */
  .bi-calendar-check::before {
    content: "üìÖ";
  }
  .bi-person-check::before {
    content: "üë®‚Äçüè´";
  }
  .bi-person-plus::before {
    content: "üë§";
  }
  .bi-bag-check::before {
    content: "üõçÔ∏è";
  }
  .bi-credit-card::before {
    content: "üí≥";
  }
  .bi-clock-history::before {
    content: "üïí";
  }
  .bi-exclamation-triangle::before {
    content: "‚ö†Ô∏è";
  }
  .bi-arrow-clockwise::before {
    content: "üîÑ";
  }

  .stat-card-info {
    --card-color: #3b82f6;
    --card-color-end: #1d4ed8;
  }

  .stat-icon {
    width: 64px;
    height: 64px;
    border-radius: 20px;
    background: linear-gradient(
      135deg,
      var(--card-color) 0%,
      var(--card-color-end) 100%
    );
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    margin-bottom: 20px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  }

  .stat-content {
    text-align: left;
  }

  .stat-number {
    font-size: 2.5rem;
    font-weight: 800;
    color: #1a202c;
    margin-bottom: 8px;
    background: linear-gradient(
      135deg,
      var(--card-color) 0%,
      var(--card-color-end) 100%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .stat-label {
    font-size: 1rem;
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 12px;
  }

  .stat-trend {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .trend-up {
    font-size: 0.9rem;
    font-weight: 600;
    color: #10b981;
  }

  .trend-text {
    font-size: 0.8rem;
    color: #6b7280;
  }

  /* Table Styles */
  .table {
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }

  .table thead th {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    font-weight: 600;
    padding: 15px;
  }

  .table tbody td {
    padding: 15px;
    vertical-align: middle;
    border-color: #f8f9fa;
  }

  .table tbody tr:hover {
    background-color: #f8f9fa;
  }

  /* Badge Styles */
  .badge {
    padding: 8px 12px;
    border-radius: 20px;
    font-weight: 500;
  }

  .bg-danger {
    background-color: #dc3545 !important;
  }
  .bg-success {
    background-color: #28a745 !important;
  }
  .bg-primary {
    background-color: #007bff !important;
  }
  .bg-warning {
    background-color: #ffc107 !important;
    color: #000 !important;
  }
  .bg-secondary {
    background-color: #6c757d !important;
  }

  /* Button Styles */
  .btn-sm {
    padding: 6px 12px;
    font-size: 0.875rem;
    margin: 0 2px;
  }

  .btn-warning {
    background-color: #ffc107;
    border-color: #ffc107;
    color: #000;
  }

  .btn-danger {
    background-color: #dc3545;
    border-color: #dc3545;
  }

  /* Grid Styles */
  .row {
    margin: 0 -15px;
  }

  .col-md-4,
  .col-md-3,
  .col-12 {
    padding: 0 15px;
  }

  /* Bootstrap-like utilities */
  .mb-3 {
    margin-bottom: 1rem;
  }
  .mb-4 {
    margin-bottom: 1.5rem;
  }
  .text-center {
    text-align: center;
  }
  .text-danger {
    color: #dc3545;
  }
  .form-check {
    display: flex;
    align-items: center;
  }
  .form-check-input {
    margin-right: 8px;
  }

  /* Enhanced Statistics Styles */
  .border-left-primary {
    border-left: 0.25rem solid #4e73df !important;
  }

  .border-left-success {
    border-left: 0.25rem solid #1cc88a !important;
  }

  .border-left-info {
    border-left: 0.25rem solid #36b9cc !important;
  }

  .border-left-warning {
    border-left: 0.25rem solid #f6c23e !important;
  }

  .text-xs {
    font-size: 0.7rem;
  }

  .font-weight-bold {
    font-weight: 700 !important;
  }

  .text-gray-800 {
    color: #5a5c69 !important;
  }

  .text-gray-300 {
    color: #dddfeb !important;
  }

  .bg-gradient-primary {
    background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
  }

  .bg-gradient-success {
    background: linear-gradient(135deg, #1cc88a 0%, #13855c 100%);
  }

  .bg-gradient-info {
    background: linear-gradient(135deg, #36b9cc 0%, #258391 100%);
  }

  .bg-gradient-warning {
    background: linear-gradient(135deg, #f6c23e 0%, #dda20a 100%);
  }

  .bg-gradient-dark {
    background: linear-gradient(135deg, #5a5c69 0%, #3d3d48 100%);
  }

  .shadow {
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15) !important;
  }

  .shadow-sm {
    box-shadow: 0 0.125rem 0.25rem 0 rgba(58, 59, 69, 0.2) !important;
  }

  .progress {
    border-radius: 10px;
    overflow: hidden;
  }

  .progress-bar {
    transition: width 0.6s ease;
  }

  .fa-2x {
    font-size: 2em;
  }

  .no-gutters {
    margin-right: 0;
    margin-left: 0;
  }

  .no-gutters > .col,
  .no-gutters > [class*="col-"] {
    padding-right: 0;
    padding-left: 0;
  }

  /* Statistics card animations */
  .stats-card-animate {
    animation: slideInUp 0.6s ease-out;
  }

  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Additional icon styles */
  .bi-bar-chart-fill::before {
    content: "üìä";
  }
  .bi-arrow-clockwise::before {
    content: "üîÑ";
  }
  .bi-graph-up::before {
    content: "üìà";
  }
  .bi-pie-chart::before {
    content: "ü•ß";
  }
  .bi-calendar-week::before {
    content: "üìÖ";
  }
  .bi-trophy::before {
    content: "üèÜ";
  }
  .bi-currency-dollar::before {
    content: "üí∞";
  }
  .bi-geo-alt::before {
    content: "üìç";
  }
  .bi-calendar-event::before {
    content: "üìÖ";
  }
  .bi-check-circle::before {
    content: "‚úÖ";
  }
  .bi-arrow-up::before {
    content: "‚¨ÜÔ∏è";
  }
  .bi-exclamation-triangle::before {
    content: "‚ö†Ô∏è";
  }

  /* Additional utility classes */
  .border-left-primary {
    border-left: 0.25rem solid #4e73df !important;
  }

  .border-left-success {
    border-left: 0.25rem solid #1cc88a !important;
  }

  .border-left-info {
    border-left: 0.25rem solid #36b9cc !important;
  }

  .border-left-warning {
    border-left: 0.25rem solid #f6c23e !important;
  }

  .text-xs {
    font-size: 0.75rem;
  }

  .font-weight-bold {
    font-weight: 700 !important;
  }

  .text-gray-800 {
    color: #5a5c69 !important;
  }

  .shadow {
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15) !important;
  }

  .no-gutters {
    margin-right: 0;
    margin-left: 0;
  }

  .no-gutters > .col,
  .no-gutters > [class*="col-"] {
    padding-right: 0;
    padding-left: 0;
  }

  /* Enhanced responsive design */
  @media (max-width: 768px) {
    .h5 {
      font-size: 1rem;
    }

    .text-xs {
      font-size: 0.6rem;
    }

    .main-content {
      padding: 1rem;
    }
  }
</style>
{% endblock %} {% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Clean Beautiful Sidebar -->
    <nav
      class="col-md-3 col-lg-2 d-md-block collapse"
      style="
        background: linear-gradient(
          135deg,
          hsl(100, 83.2%, 62.5%) ; 0%,
          rgb(91, 162, 75) 100%
        );
        min-height: 100vh;
        box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);
        position: relative;
      "
    >
      <div class="position-sticky pt-0">
        <!-- Header Section -->
        <div
          style="
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
          "
        >
          <div class="d-flex align-items-center">
            <div
              style="
                width: 50px;
                height: 50px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
                margin-right: 12px;
              "
            >
              üë®‚Äçüíº
            </div>
            <div>
              <h6
                style="
                  color: white;
                  margin: 0;
                  font-size: 1rem;
                  font-weight: 600;
                "
              >
                Admin Panel
              </h6>
              <small
                style="color: rgba(255, 255, 255, 0.8); font-size: 0.8rem"
                id="adminName"
                >Welcome, Admin</small
              >
            </div>
          </div>
        </div>

        <!-- Navigation Menu -->
        <div style="padding: 1rem 0">
          <a
            class="nav-link active"
            href="#dashboard"
            onclick="showSection('dashboard')"
            style="
              color: white;
              padding: 0.8rem 1rem;
              margin: 0.3rem 0.8rem;
              border-radius: 12px;
              text-decoration: none;
              display: flex;
              align-items: center;
              background: rgba(255, 255, 255, 0.2);
              font-weight: 500;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateX(5px)'"
            onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateX(0)'"
          >
            <span style="margin-right: 0.8rem; font-size: 1.1rem">üìä</span>
            <span>Dashboard</span>
          </a>

          <a
            class="nav-link"
            href="#users"
            onclick="showSection('users')"
            style="
              color: rgba(255, 255, 255, 0.9);
              padding: 0.8rem 1rem;
              margin: 0.3rem 0.8rem;
              border-radius: 12px;
              text-decoration: none;
              display: flex;
              align-items: center;
              background: rgba(255, 255, 255, 0.1);
              font-weight: 500;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateX(5px)'; this.style.color='white'"
            onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.transform='translateX(0)'; this.style.color='rgba(255,255,255,0.9)'"
          >
            <span style="margin-right: 0.8rem; font-size: 1.1rem">üë•</span>
            <span>User Management</span>
          </a>

          <a
            class="nav-link"
            href="#terrains"
            onclick="showSection('terrains')"
            style="
              color: rgba(255, 255, 255, 0.9);
              padding: 0.8rem 1rem;
              margin: 0.3rem 0.8rem;
              border-radius: 12px;
              text-decoration: none;
              display: flex;
              align-items: center;
              background: rgba(255, 255, 255, 0.1);
              font-weight: 500;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateX(5px)'; this.style.color='white'"
            onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.transform='translateX(0)'; this.style.color='rgba(255,255,255,0.9)'"
          >
            <span style="margin-right: 0.8rem; font-size: 1.1rem">üèüÔ∏è</span>
            <span>Terrain Management</span>
          </a>

          <a
            class="nav-link"
            href="#coaches"
            onclick="showSection('coaches')"
            style="
              color: rgba(255, 255, 255, 0.9);
              padding: 0.8rem 1rem;
              margin: 0.3rem 0.8rem;
              border-radius: 12px;
              text-decoration: none;
              display: flex;
              align-items: center;
              background: rgba(255, 255, 255, 0.1);
              font-weight: 500;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateX(5px)'; this.style.color='white'"
            onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.transform='translateX(0)'; this.style.color='rgba(255,255,255,0.9)'"
          >
            <span style="margin-right: 0.8rem; font-size: 1.1rem">üë®‚Äçüè´</span>
            <span>Coach Management</span>
          </a>

          <a
            class="nav-link"
            href="#stats"
            onclick="showSection('stats')"
            style="
              color: rgba(255, 255, 255, 0.9);
              padding: 0.8rem 1rem;
              margin: 0.3rem 0.8rem;
              border-radius: 12px;
              text-decoration: none;
              display: flex;
              align-items: center;
              background: rgba(255, 255, 255, 0.1);
              font-weight: 500;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateX(5px)'; this.style.color='white'"
            onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.transform='translateX(0)'; this.style.color='rgba(255,255,255,0.9)'"
          >
            <span style="margin-right: 0.8rem; font-size: 1.1rem">üìà</span>
            <span>Statistics</span>
          </a>

          <a
            class="nav-link"
            href="#reservations"
            onclick="showSection('reservations')"
            style="
              color: rgba(255, 255, 255, 0.9);
              padding: 0.8rem 1rem;
              margin: 0.3rem 0.8rem;
              border-radius: 12px;
              text-decoration: none;
              display: flex;
              align-items: center;
              background: rgba(255, 255, 255, 0.1);
              font-weight: 500;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateX(5px)'; this.style.color='white'"
            onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.transform='translateX(0)'; this.style.color='rgba(255,255,255,0.9)'"
          >
            <span style="margin-right: 0.8rem; font-size: 1.1rem">üìÖ</span>
            <span>All Reservations</span>
          </a>
        </div>

        <!-- Logout Section -->
        <div
          style="position: absolute; bottom: 1rem; left: 0.8rem; right: 0.8rem"
        >
          <button
            onclick="logout()"
            style="
              background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
              border: none;
              color: white;
              padding: 0.8rem;
              border-radius: 12px;
              width: 100%;
              font-weight: 600;
              transition: all 0.3s ease;
              display: flex;
              align-items: center;
              justify-content: center;
            "
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(255, 107, 107, 0.4)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
          >
            <span style="margin-right: 0.5rem">üö™</span>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </nav>

    <!-- Main content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
      <!-- Modern Dashboard Header -->
      <div
        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
      >
        <div>
          <h1 class="h2 text-primary">
            üéæ Admin Dashboard
            <span class="badge bg-primary ms-2">Pro</span>
          </h1>
          <p class="text-muted mb-0">Manage your tennis club with ease</p>
        </div>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group me-2">
            <button
              type="button"
              class="btn btn-sm btn-outline-primary"
              onclick="refreshData()"
            >
              üîÑ Refresh
            </button>
          </div>
          <div class="d-flex align-items-center">
            <div
              class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2"
              style="width: 32px; height: 32px"
            >
              üë§
            </div>
            <div>
              <small class="fw-bold" id="adminNameHeader">Admin</small><br />
              <small class="text-muted">Administrator</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Dashboard Overview -->
      <div id="dashboard" class="section">
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="card border-left-primary shadow h-100 py-2">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                    <div
                      class="text-xs font-weight-bold text-primary text-uppercase mb-1"
                    >
                      Total Users
                    </div>
                    <div
                      class="h5 mb-0 font-weight-bold text-gray-800"
                      id="totalUsers"
                    >
                      0
                    </div>
                    <div class="text-xs text-success mt-1">
                      ‚ÜóÔ∏è +12% from last month
                    </div>
                  </div>
                  <div class="col-auto">
                    <div
                      class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center"
                      style="width: 48px; height: 48px; font-size: 1.5rem"
                    >
                      üë•
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card border-left-success shadow h-100 py-2">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                    <div
                      class="text-xs font-weight-bold text-success text-uppercase mb-1"
                    >
                      Tennis Courts
                    </div>
                    <div
                      class="h5 mb-0 font-weight-bold text-gray-800"
                      id="totalTerrains"
                    >
                      0
                    </div>
                    <div class="text-xs text-success mt-1">
                      ‚úÖ All operational
                    </div>
                  </div>
                  <div class="col-auto">
                    <div
                      class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center"
                      style="width: 48px; height: 48px; font-size: 1.5rem"
                    >
                      üèüÔ∏è
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card border-left-warning shadow h-100 py-2">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                    <div
                      class="text-xs font-weight-bold text-warning text-uppercase mb-1"
                    >
                      Coaches
                    </div>
                    <div
                      class="h5 mb-0 font-weight-bold text-gray-800"
                      id="totalCoaches"
                    >
                      0
                    </div>
                    <div class="text-xs text-warning mt-1">
                      ‚≠ê 4.8 avg rating
                    </div>
                  </div>
                  <div class="col-auto">
                    <div
                      class="bg-warning text-white rounded-circle d-flex align-items-center justify-content-center"
                      style="width: 48px; height: 48px; font-size: 1.5rem"
                    >
                      üë®‚Äçüè´
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card border-left-info shadow h-100 py-2">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                    <div
                      class="text-xs font-weight-bold text-info text-uppercase mb-1"
                    >
                      Reservations
                    </div>
                    <div
                      class="h5 mb-0 font-weight-bold text-gray-800"
                      id="totalReservations"
                    >
                      0
                    </div>
                    <div class="text-xs text-info mt-1">üìà +8% this week</div>
                  </div>
                  <div class="col-auto">
                    <div
                      class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center"
                      style="width: 48px; height: 48px; font-size: 1.5rem"
                    >
                      üìÖ
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div
                class="card-header d-flex justify-content-between align-items-center"
              >
                <h5 class="mb-0">
                  <i class="bi bi-clock-history me-2"></i>Recent Activity
                </h5>
                <button
                  class="btn btn-sm btn-outline-primary"
                  onclick="loadRecentActivity()"
                >
                  <i class="bi bi-arrow-clockwise me-1"></i>Refresh
                </button>
              </div>
              <div class="card-body p-0">
                <div
                  id="recentActivity"
                  style="max-height: 500px; overflow-y: auto"
                >
                  <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 text-muted">Loading recent activities...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- User Management Section -->
      <div id="users" class="section d-none">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>User Management</h3>
          <button class="btn btn-primary" onclick="showAddUserModal()">
            <i class="bi bi-plus"></i> Add User
          </button>
        </div>

        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Date Joined</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="usersTableBody">
                  <tr>
                    <td colspan="6" class="text-center">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Terrain Management Section -->
      <div id="terrains" class="section d-none">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Terrain Management</h3>
          <button class="btn btn-primary" onclick="showAddTerrainModal()">
            <i class="bi bi-plus"></i> Add Terrain
          </button>
        </div>

        <div class="row" id="terrainsGrid">
          <div class="col-12 text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Coach Management Section -->
      <div id="coaches" class="section d-none">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Coach Management & Scheduling</h3>
          <button class="btn btn-primary" onclick="showAddCoachModal()">
            <i class="bi bi-plus"></i> Add Coach
          </button>
        </div>

        <div class="row" id="coachesGrid">
          <div class="col-12 text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Statistics Section -->
      <div id="stats" class="section d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">
            <i class="bi bi-bar-chart-fill text-primary me-2"></i>
            Statistics & Analytics
          </h3>
          <button class="btn btn-outline-primary" onclick="refreshStatistics()">
            <i class="bi bi-arrow-clockwise me-1"></i>Refresh
          </button>
        </div>

        <!-- Key Performance Indicators -->
        <div class="row mb-4" id="statsContent">
          <!-- Content will be loaded dynamically -->
        </div>

        <!-- Charts Section -->
        <div class="row mb-4">
          <div class="col-lg-8">
            <div class="card shadow-sm">
              <div class="card-header bg-gradient-primary text-white">
                <h5 class="mb-0">
                  <i class="bi bi-graph-up me-2"></i>
                  Monthly Revenue & Reservations Trend
                </h5>
              </div>
              <div class="card-body">
                <canvas id="monthlyTrendChart" height="100"></canvas>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card shadow-sm">
              <div class="card-header bg-gradient-info text-white">
                <h5 class="mb-0">
                  <i class="bi bi-pie-chart me-2"></i>
                  User Roles Distribution
                </h5>
              </div>
              <div class="card-body">
                <canvas id="rolesChart" height="200"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Additional Analytics -->
        <div class="row mb-4">
          <div class="col-lg-6">
            <div class="card shadow-sm">
              <div class="card-header bg-gradient-success text-white">
                <h5 class="mb-0">
                  <i class="bi bi-calendar-week me-2"></i>
                  Weekly Activity
                </h5>
              </div>
              <div class="card-body">
                <canvas id="weeklyActivityChart" height="150"></canvas>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card shadow-sm">
              <div class="card-header bg-gradient-warning text-white">
                <h5 class="mb-0">
                  <i class="bi bi-trophy me-2"></i>
                  Top Performing Courts
                </h5>
              </div>
              <div class="card-body">
                <canvas id="topCourtsChart" height="150"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Performance Metrics -->
        <div class="row">
          <div class="col-12">
            <div class="card shadow-sm">
              <div class="card-header bg-gradient-dark text-white">
                <h5 class="mb-0">
                  <i class="bi bi-speedometer2 me-2"></i>
                  Performance Metrics
                </h5>
              </div>
              <div class="card-body">
                <div class="row" id="performanceMetrics">
                  <!-- Performance metrics will be loaded here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- All Reservations Section -->
      <div id="reservations" class="section d-none">
        <h3>All Reservations</h3>

        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Terrain/Coach</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="reservationsTableBody">
                  <tr>
                    <td colspan="7" class="text-center">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- Modals Container -->
<div id="modalsContainer">
  <!-- Add User Modal -->
  <div class="modal fade" id="addUserModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New User</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <form id="addUserForm">
            <div class="mb-3">
              <label for="userUsername" class="form-label">Username</label>
              <input
                type="text"
                class="form-control"
                id="userUsername"
                required
              />
            </div>
            <div class="mb-3">
              <label for="userEmail" class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                id="userEmail"
                required
              />
            </div>
            <div class="mb-3">
              <label for="userPassword" class="form-label">Password</label>
              <input
                type="password"
                class="form-control"
                id="userPassword"
                required
              />
            </div>
            <div class="mb-3">
              <label for="userRole" class="form-label">Role</label>
              <select class="form-control" id="userRole" required>
                <option value="">Select Role</option>
                <option value="joueur">Player (Joueur)</option>
                <option value="coach">Coach</option>
                <option value="admin">Administrator</option>
                <option value="abonn√©e">Subscriber (Abonn√©)</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="submitAddUser()"
          >
            Add User
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div class="modal fade" id="editUserModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit User</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <form id="editUserForm">
            <input type="hidden" id="editUserId" />
            <div class="mb-3">
              <label for="editUserUsername" class="form-label">Username</label>
              <input
                type="text"
                class="form-control"
                id="editUserUsername"
                required
              />
            </div>
            <div class="mb-3">
              <label for="editUserEmail" class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                id="editUserEmail"
                required
              />
            </div>
            <div class="mb-3">
              <label for="editUserRole" class="form-label">Role</label>
              <select class="form-control" id="editUserRole" required>
                <option value="joueur">Player (Joueur)</option>
                <option value="coach">Coach</option>
                <option value="admin">Administrator</option>
                <option value="abonn√©e">Subscriber (Abonn√©)</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="submitEditUser()"
          >
            Update User
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Terrain Modal -->
  <div class="modal fade" id="addTerrainModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Court</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <form id="addTerrainForm">
            <div class="mb-3">
              <label for="terrainName" class="form-label">Court Name</label>
              <input
                type="text"
                class="form-control"
                id="terrainName"
                required
              />
            </div>
            <div class="mb-3">
              <label for="terrainLocation" class="form-label">Location</label>
              <input
                type="text"
                class="form-control"
                id="terrainLocation"
                required
              />
            </div>
            <div class="mb-3">
              <label for="terrainPrice" class="form-label"
                >Price per Hour ($)</label
              >
              <input
                type="number"
                step="0.01"
                class="form-control"
                id="terrainPrice"
                required
              />
            </div>
            <div class="mb-3">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="terrainAvailable"
                  checked
                />
                <label class="form-check-label" for="terrainAvailable"
                  >Available</label
                >
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="submitAddTerrain()"
          >
            Add Court
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Terrain Modal -->
  <div class="modal fade" id="editTerrainModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Court</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <form id="editTerrainForm">
            <input type="hidden" id="editTerrainId" />
            <div class="mb-3">
              <label for="editTerrainName" class="form-label">Court Name</label>
              <input
                type="text"
                class="form-control"
                id="editTerrainName"
                required
              />
            </div>
            <div class="mb-3">
              <label for="editTerrainLocation" class="form-label"
                >Location</label
              >
              <input
                type="text"
                class="form-control"
                id="editTerrainLocation"
                required
              />
            </div>
            <div class="mb-3">
              <label for="editTerrainPrice" class="form-label"
                >Price per Hour ($)</label
              >
              <input
                type="number"
                step="0.01"
                class="form-control"
                id="editTerrainPrice"
                required
              />
            </div>
            <div class="mb-3">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="editTerrainAvailable"
                />
                <label class="form-check-label" for="editTerrainAvailable"
                  >Available</label
                >
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="submitEditTerrain()"
          >
            Update Court
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Coach Modal -->
  <div class="modal fade" id="addCoachModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Coach</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <form id="addCoachForm">
            <div class="mb-3">
              <label for="coachName" class="form-label">Coach Name</label>
              <input type="text" class="form-control" id="coachName" required />
            </div>
            <div class="mb-3">
              <label for="coachEmail" class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                id="coachEmail"
                required
              />
            </div>
            <div class="mb-3">
              <label for="coachPhone" class="form-label">Phone</label>
              <input type="tel" class="form-control" id="coachPhone" />
            </div>
            <div class="mb-3">
              <label for="coachPrice" class="form-label"
                >Price per Hour ($)</label
              >
              <input
                type="number"
                step="0.01"
                class="form-control"
                id="coachPrice"
                required
              />
            </div>
            <div class="mb-3">
              <label for="coachExperience" class="form-label"
                >Experience (years)</label
              >
              <input type="number" class="form-control" id="coachExperience" />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="submitAddCoach()"
          >
            Add Coach
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Coach Modal -->
  <div class="modal fade" id="editCoachModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="bi bi-pencil-square me-2"></i>Edit Coach
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <form id="editCoachForm">
            <input type="hidden" id="editCoachId" />

            <div class="mb-3">
              <label for="editCoachName" class="form-label">Coach Name *</label>
              <input
                type="text"
                class="form-control"
                id="editCoachName"
                required
              />
            </div>

            <div class="mb-3">
              <label for="editCoachEmail" class="form-label">Email *</label>
              <input
                type="email"
                class="form-control"
                id="editCoachEmail"
                required
              />
            </div>

            <div class="mb-3">
              <label for="editCoachPhone" class="form-label">Phone</label>
              <input type="tel" class="form-control" id="editCoachPhone" />
            </div>

            <div class="mb-3">
              <label for="editCoachPrice" class="form-label"
                >Price per Hour ($) *</label
              >
              <input
                type="number"
                class="form-control"
                id="editCoachPrice"
                min="0"
                step="0.01"
                required
              />
            </div>

            <div class="mb-3">
              <label for="editCoachExperience" class="form-label"
                >Experience (years)</label
              >
              <input
                type="number"
                class="form-control"
                id="editCoachExperience"
                min="0"
              />
            </div>

            <div class="mb-3">
              <label for="editCoachSpecialization" class="form-label"
                >Specialization</label
              >
              <input
                type="text"
                class="form-control"
                id="editCoachSpecialization"
                placeholder="e.g., Singles, Doubles, Beginners"
              />
            </div>

            <div class="mb-3 form-check">
              <input
                type="checkbox"
                class="form-check-input"
                id="editCoachActive"
                checked
              />
              <label class="form-check-label" for="editCoachActive">
                Active Coach
              </label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="saveCoachChanges()"
          >
            <i class="bi bi-check-lg me-1"></i>Save Changes
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Coach Schedule Management Modal -->
  <div class="modal fade" id="coachScheduleModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="bi bi-calendar-week me-2"></i>
            Manage Coach Schedule: <span id="scheduleCoachName"></span>
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            Manage schedule slots for this coach. Add specific date and time
            slots that students can book.
          </div>

          <input type="hidden" id="scheduleCoachId" />

          <div class="row">
            <!-- Add New Schedule Slot -->
            <div class="col-md-5">
              <h6 class="mb-3">
                <i class="bi bi-plus-circle me-2"></i>Add New Schedule Slot
              </h6>

              <div class="card">
                <div class="card-body">
                  <form id="newScheduleSlotForm">
                    <div class="mb-3">
                      <label for="newSlotDate" class="form-label">Date *</label>
                      <input
                        type="date"
                        class="form-control"
                        id="newSlotDate"
                        required
                      />
                    </div>

                    <div class="mb-3">
                      <label for="newSlotStartTime" class="form-label"
                        >Start Time *</label
                      >
                      <input
                        type="time"
                        class="form-control"
                        id="newSlotStartTime"
                        required
                      />
                    </div>

                    <div class="mb-3">
                      <label for="newSlotEndTime" class="form-label"
                        >End Time *</label
                      >
                      <input
                        type="time"
                        class="form-control"
                        id="newSlotEndTime"
                        required
                      />
                    </div>

                    <button
                      type="button"
                      class="btn btn-primary w-100"
                      onclick="addNewScheduleSlot()"
                    >
                      <i class="bi bi-plus-lg me-1"></i>Add Schedule Slot
                    </button>
                  </form>
                </div>
              </div>
            </div>

            <!-- Existing Schedule Slots -->
            <div class="col-md-7">
              <h6 class="mb-3">
                <i class="bi bi-calendar-check me-2"></i>Current Schedule
              </h6>

              <div
                id="coachScheduleList"
                style="max-height: 400px; overflow-y: auto"
              >
                <div class="text-center text-muted py-4">
                  <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <p class="mt-2">Loading schedule...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Close
          </button>
          <button
            type="button"
            class="btn btn-outline-primary"
            onclick="loadCoachSchedule(document.getElementById('scheduleCoachId').value)"
          >
            <i class="bi bi-arrow-clockwise me-1"></i>Refresh Schedule
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Authentication check
  if (
    !localStorage.getItem("token") ||
    localStorage.getItem("role") !== "admin"
  ) {
    window.location.href = "/auth/login/";
  }

  // Set admin name
  document.getElementById(
    "adminName"
  ).textContent = `Welcome, ${localStorage.getItem("username")}`;

  // Global variables
  let currentSection = "dashboard";

  // API helper
  const api = axios.create({
    headers: {
      Authorization: `Bearer ${localStorage.getItem("token")}`,
    },
  });

  // Section management
  function showSection(sectionName) {
    // Hide all sections
    document.querySelectorAll(".section").forEach((section) => {
      section.classList.add("d-none");
    });

    // Show selected section
    document.getElementById(sectionName).classList.remove("d-none");

    // Update active nav
    document.querySelectorAll(".nav-link").forEach((link) => {
      link.classList.remove("active");
    });
    event.target.classList.add("active");

    currentSection = sectionName;

    // Load section data
    loadSectionData(sectionName);
  }

  // Load section data
  function loadSectionData(section) {
    switch (section) {
      case "dashboard":
        loadDashboardData();
        break;
      case "users":
        loadUsers();
        break;
      case "terrains":
        loadTerrains();
        break;
      case "coaches":
        loadCoaches();
        break;
      case "stats":
        loadStatistics();
        break;
      case "reservations":
        loadAllReservations();
        break;
    }
  }

  // Load dashboard data
  async function loadDashboardData() {
    try {
      // Load overview stats using new API endpoints
      const statsRes = await api.get("/res/api/dashboard/stats/");
      const stats = statsRes.data;

      document.getElementById("totalUsers").textContent =
        stats.total_users || 0;
      document.getElementById("totalTerrains").textContent =
        stats.total_terrains || 0;
      document.getElementById("totalCoaches").textContent =
        stats.total_coaches || 0;
      document.getElementById("totalReservations").textContent =
        stats.total_reservations || 0;

      // Load recent activity
      loadRecentActivity();
    } catch (error) {
      console.error("Error loading dashboard data:", error);
      // Fallback to individual API calls
      loadDashboardDataFallback();
    }
  }

  // Fallback method for loading dashboard data
  async function loadDashboardDataFallback() {
    try {
      const [terrainsRes, coachesRes] = await Promise.all([
        api.get("/res/terrains/"),
        api.get("/coaches/"),
      ]);

      document.getElementById("totalTerrains").textContent =
        terrainsRes.data.length;
      document.getElementById("totalCoaches").textContent =
        coachesRes.data.length;
    } catch (error) {
      console.error("Error loading fallback dashboard data:", error);
    }
  }

  // Load recent activity
  async function loadRecentActivity() {
    try {
      const response = await api.get("/res/api/admin/recent-activities/");
      const activities = response.data.activities || [];

      if (activities.length === 0) {
        document.getElementById("recentActivity").innerHTML = `
          <div class="text-center text-muted py-4">
            <i class="bi bi-clock-history" style="font-size: 2rem;"></i>
            <p class="mt-2">No recent activity</p>
          </div>
        `;
        return;
      }

      const activityHtml = activities
        .map(
          (activity) => `
        <div class="d-flex align-items-start border-bottom py-3 activity-item px-3">
          <div class="flex-shrink-0 me-3">
            <div class="rounded-circle bg-${
              activity.color
            } bg-opacity-10 p-2 activity-icon">
              <i class="bi ${activity.icon} text-${activity.color}"></i>
            </div>
          </div>
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="mb-1 fw-semibold">${activity.title}</h6>
                <p class="mb-1 text-muted">${activity.description}</p>
                <small class="text-muted">${activity.details}</small>
              </div>
              <div class="text-end">
                <small class="text-muted">${activity.relative_time}</small>
                <br>
                <span class="badge bg-${activity.color} bg-opacity-20 text-${
            activity.color
          } mt-1">
                  ${getActivityTypeLabel(activity.type)}
                </span>
              </div>
            </div>
          </div>
        </div>
      `
        )
        .join("");

      document.getElementById("recentActivity").innerHTML = activityHtml;
    } catch (error) {
      console.error("Error loading recent activity:", error);
      document.getElementById("recentActivity").innerHTML = `
        <div class="text-center text-danger py-4">
          <i class="bi bi-exclamation-triangle" style="font-size: 2rem;"></i>
          <p class="mt-2">Error loading recent activity</p>
          <button class="btn btn-sm btn-outline-danger" onclick="loadRecentActivity()">
            <i class="bi bi-arrow-clockwise me-1"></i>Retry
          </button>
        </div>
      `;
    }
  }

  // Helper function to get activity type labels
  function getActivityTypeLabel(type) {
    const labels = {
      court_reservation: "Court",
      coach_reservation: "Coach",
      user_registration: "User",
      equipment_order: "Equipment",
      payment: "Payment",
    };
    return labels[type] || "Activity";
  }

  // Refresh data
  function refreshData() {
    loadSectionData(currentSection);
  }

  // Logout
  function logout() {
    localStorage.clear();
    window.location.href = "/auth/login/";
  }

  // Load users
  async function loadUsers() {
    try {
      const response = await api.get("/res/api/users/");
      const users = response.data;

      const tableBody = document.getElementById("usersTableBody");
      tableBody.innerHTML = users
        .map(
          (user) => `
      <tr>
        <td>${user.id}</td>
        <td>${user.username}</td>
        <td>${user.email}</td>
        <td><span class="badge bg-${getRoleBadgeColor(user.role)}">${
            user.role
          }</span></td>
        <td>${new Date(user.date_joined).toLocaleDateString()}</td>
        <td>
          <button class="btn btn-sm btn-warning" onclick="editUser(${
            user.id
          })">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteUser(${
            user.id
          })">Delete</button>
        </td>
      </tr>
    `
        )
        .join("");
    } catch (error) {
      console.error("Error loading users:", error);
      document.getElementById("usersTableBody").innerHTML =
        '<tr><td colspan="6" class="text-center text-danger">Error loading users</td></tr>';
    }
  }

  // Load terrains
  async function loadTerrains() {
    try {
      const response = await api.get("/res/api/terrains/");
      const terrains = response.data;

      const grid = document.getElementById("terrainsGrid");
      grid.innerHTML = terrains
        .map(
          (terrain) => `
      <div class="col-md-4 mb-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">${terrain.name}</h5>
            <p class="card-text">
              <strong>Location:</strong> ${terrain.location}<br>
              <strong>Price:</strong> $${terrain.price_per_hour}/hour<br>
              <strong>Status:</strong> <span class="badge bg-${
                terrain.available ? "success" : "danger"
              }">${terrain.available ? "Available" : "Unavailable"}</span>
            </p>
            <button class="btn btn-sm btn-warning" onclick="editTerrain(${
              terrain.id
            })">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteTerrain(${
              terrain.id
            })">Delete</button>
          </div>
        </div>
      </div>
    `
        )
        .join("");
    } catch (error) {
      console.error("Error loading terrains:", error);
      document.getElementById("terrainsGrid").innerHTML =
        '<div class="col-12 text-center text-danger">Error loading terrains</div>';
    }
  }

  // Load coaches
  async function loadCoaches() {
    try {
      const response = await api.get("/res/coaches/");
      const coaches = response.data;

      const grid = document.getElementById("coachesGrid");
      grid.innerHTML = coaches
        .map(
          (coach) => `
      <div class="col-md-4 mb-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">${coach.name}</h5>
            <p class="card-text">
              <strong>Email:</strong> ${coach.email}<br>
              <strong>Phone:</strong> ${coach.phone || "N/A"}<br>
              <strong>Price:</strong> $${coach.price_per_hour}/hour<br>
              <strong>Experience:</strong> ${coach.experience || "N/A"} years
            </p>
            <button class="btn btn-sm btn-info" onclick="manageCoachSchedule(${
              coach.id
            }, '${coach.name}')">
              <i class="bi bi-calendar-week"></i> Schedule
            </button>
            <button class="btn btn-sm btn-warning" onclick="editCoach(${
              coach.id
            })">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteCoach(${
              coach.id
            })">Delete</button>
          </div>
        </div>
      </div>
    `
        )
        .join("");
    } catch (error) {
      console.error("Error loading coaches:", error);
      document.getElementById("coachesGrid").innerHTML =
        '<div class="col-12 text-center text-danger">Error loading coaches</div>';
    }
  }

  // Helper functions
  function getRoleBadgeColor(role) {
    const colors = {
      admin: "danger",
      coach: "success",
      joueur: "primary",
      abonn√©e: "warning",
    };
    return colors[role] || "secondary";
  }

  // ==================== MODAL FUNCTIONS ====================

  // User Management Modals
  function showAddUserModal() {
    const modal = new bootstrap.Modal(document.getElementById("addUserModal"));
    modal.show();
  }

  async function submitAddUser() {
    try {
      const userData = {
        username: document.getElementById("userUsername").value,
        email: document.getElementById("userEmail").value,
        password: document.getElementById("userPassword").value,
        role: document.getElementById("userRole").value,
      };

      const response = await api.post("/auth/api/register/", userData);

      if (response.status === 201) {
        alert("User added successfully!");
        bootstrap.Modal.getInstance(
          document.getElementById("addUserModal")
        ).hide();
        document.getElementById("addUserForm").reset();
        loadUsers();
      }
    } catch (error) {
      console.error("Error adding user:", error);
      alert(
        "Error adding user: " + (error.response?.data?.error || "Unknown error")
      );
    }
  }

  async function editUser(id) {
    try {
      // Get user data
      const users = await api.get("/res/api/users/");
      const user = users.data.find((u) => u.id === id);

      if (user) {
        document.getElementById("editUserId").value = user.id;
        document.getElementById("editUserUsername").value = user.username;
        document.getElementById("editUserEmail").value = user.email;
        document.getElementById("editUserRole").value = user.role;

        const modal = new bootstrap.Modal(
          document.getElementById("editUserModal")
        );
        modal.show();
      }
    } catch (error) {
      console.error("Error loading user data:", error);
      alert("Error loading user data");
    }
  }

  async function submitEditUser() {
    try {
      const userId = document.getElementById("editUserId").value;
      const roleData = {
        role: document.getElementById("editUserRole").value,
      };

      const response = await api.put(
        `/res/api/users/${userId}/role/`,
        roleData
      );

      if (response.status === 200) {
        alert("User updated successfully!");
        bootstrap.Modal.getInstance(
          document.getElementById("editUserModal")
        ).hide();
        loadUsers();
      }
    } catch (error) {
      console.error("Error updating user:", error);
      alert(
        "Error updating user: " +
          (error.response?.data?.error || "Unknown error")
      );
    }
  }

  async function deleteUser(id) {
    if (confirm("Are you sure you want to delete this user?")) {
      try {
        const response = await api.delete(`/res/api/users/${id}/delete/`);

        if (response.status === 200) {
          alert("User deleted successfully!");
          loadUsers();
        }
      } catch (error) {
        console.error("Error deleting user:", error);
        alert(
          "Error deleting user: " +
            (error.response?.data?.error || "Unknown error")
        );
      }
    }
  }

  // Terrain Management Modals
  function showAddTerrainModal() {
    const modal = new bootstrap.Modal(
      document.getElementById("addTerrainModal")
    );
    modal.show();
  }

  async function submitAddTerrain() {
    try {
      const terrainData = {
        name: document.getElementById("terrainName").value,
        location: document.getElementById("terrainLocation").value,
        price_per_hour: document.getElementById("terrainPrice").value,
        available: document.getElementById("terrainAvailable").checked,
      };

      const response = await api.post("/res/api/terrains/", terrainData);

      if (response.status === 200) {
        alert("Court added successfully!");
        bootstrap.Modal.getInstance(
          document.getElementById("addTerrainModal")
        ).hide();
        document.getElementById("addTerrainForm").reset();
        loadTerrains();
      }
    } catch (error) {
      console.error("Error adding terrain:", error);
      alert(
        "Error adding court: " +
          (error.response?.data?.error || "Unknown error")
      );
    }
  }

  async function editTerrain(id) {
    try {
      // Get terrain data
      const terrains = await api.get("/res/api/terrains/");
      const terrain = terrains.data.find((t) => t.id === id);

      if (terrain) {
        document.getElementById("editTerrainId").value = terrain.id;
        document.getElementById("editTerrainName").value = terrain.name;
        document.getElementById("editTerrainLocation").value = terrain.location;
        document.getElementById("editTerrainPrice").value =
          terrain.price_per_hour;
        document.getElementById("editTerrainAvailable").checked =
          terrain.available;

        const modal = new bootstrap.Modal(
          document.getElementById("editTerrainModal")
        );
        modal.show();
      }
    } catch (error) {
      console.error("Error loading terrain data:", error);
      alert("Error loading terrain data");
    }
  }

  async function submitEditTerrain() {
    try {
      const terrainId = document.getElementById("editTerrainId").value;
      const terrainData = {
        name: document.getElementById("editTerrainName").value,
        location: document.getElementById("editTerrainLocation").value,
        price_per_hour: document.getElementById("editTerrainPrice").value,
        available: document.getElementById("editTerrainAvailable").checked,
      };

      const response = await api.put(
        `/res/api/terrains/${terrainId}/`,
        terrainData
      );

      if (response.status === 200) {
        alert("Court updated successfully!");
        bootstrap.Modal.getInstance(
          document.getElementById("editTerrainModal")
        ).hide();
        loadTerrains();
      }
    } catch (error) {
      console.error("Error updating terrain:", error);
      alert(
        "Error updating court: " +
          (error.response?.data?.error || "Unknown error")
      );
    }
  }

  async function deleteTerrain(id) {
    if (confirm("Are you sure you want to delete this court?")) {
      try {
        const response = await api.delete(`/res/api/terrains/${id}/`);

        if (response.status === 200) {
          alert("Court deleted successfully!");
          loadTerrains();
        }
      } catch (error) {
        console.error("Error deleting terrain:", error);
        alert(
          "Error deleting court: " +
            (error.response?.data?.error || "Unknown error")
        );
      }
    }
  }

  // Coach Management Modals
  function showAddCoachModal() {
    const modal = new bootstrap.Modal(document.getElementById("addCoachModal"));
    modal.show();
  }

  async function submitAddCoach() {
    try {
      const coachData = {
        name: document.getElementById("coachName").value,
        email: document.getElementById("coachEmail").value,
        phone: document.getElementById("coachPhone").value,
        price_per_hour: document.getElementById("coachPrice").value,
        experience: document.getElementById("coachExperience").value,
      };

      const response = await api.post("/res/add_coach/", coachData);

      if (response.status === 200 || response.status === 201) {
        alert("Coach added successfully!");
        bootstrap.Modal.getInstance(
          document.getElementById("addCoachModal")
        ).hide();
        document.getElementById("addCoachForm").reset();
        loadCoaches();
      }
    } catch (error) {
      console.error("Error adding coach:", error);
      alert(
        "Error adding coach: " +
          (error.response?.data?.error || "Unknown error")
      );
    }
  }

  async function editCoach(id) {
    try {
      // Load coach details
      const response = await api.get(`/res/api/coaches/${id}/details/`);

      if (response.status === 200) {
        const coach = response.data.coach;

        // Populate edit form
        document.getElementById("editCoachId").value = coach.id;
        document.getElementById("editCoachName").value = coach.name;
        document.getElementById("editCoachEmail").value = coach.email;
        document.getElementById("editCoachPhone").value = coach.phone || "";
        document.getElementById("editCoachPrice").value = coach.price_per_hour;
        document.getElementById("editCoachExperience").value =
          coach.experience || "";
        document.getElementById("editCoachSpecialization").value =
          coach.specialization || "";
        document.getElementById("editCoachActive").checked = coach.is_active;

        // Show modal
        const modal = new bootstrap.Modal(
          document.getElementById("editCoachModal")
        );
        modal.show();
      }
    } catch (error) {
      console.error("Error loading coach details:", error);
      alert(
        "Error loading coach details: " +
          (error.response?.data?.error || "Unknown error")
      );
    }
  }

  async function saveCoachChanges() {
    try {
      const coachId = document.getElementById("editCoachId").value;
      const updateData = {
        name: document.getElementById("editCoachName").value,
        email: document.getElementById("editCoachEmail").value,
        phone: document.getElementById("editCoachPhone").value,
        price_per_hour: parseFloat(
          document.getElementById("editCoachPrice").value
        ),
        experience:
          parseInt(document.getElementById("editCoachExperience").value) ||
          null,
        specialization: document.getElementById("editCoachSpecialization")
          .value,
        is_active: document.getElementById("editCoachActive").checked,
      };

      // Validate required fields
      if (!updateData.name || !updateData.email || !updateData.price_per_hour) {
        alert("Please fill in all required fields (Name, Email, Price)");
        return;
      }

      // Validate email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(updateData.email)) {
        alert("Please enter a valid email address");
        return;
      }

      // Validate price
      if (updateData.price_per_hour <= 0) {
        alert("Price per hour must be greater than 0");
        return;
      }

      const response = await api.put(
        `/res/api/coaches/${coachId}/update/`,
        updateData
      );

      if (response.status === 200) {
        alert("‚úÖ Coach updated successfully!");

        // Close modal
        const modal = bootstrap.Modal.getInstance(
          document.getElementById("editCoachModal")
        );
        modal.hide();

        // Reload coaches list
        loadCoaches();
      }
    } catch (error) {
      console.error("Error updating coach:", error);

      if (error.response?.status === 400) {
        alert(
          "‚ùå Validation error: " +
            (error.response?.data?.error || "Invalid data provided")
        );
      } else if (error.response?.status === 403) {
        alert("‚ùå Permission denied. Admin access required.");
      } else {
        alert(
          "‚ùå Error updating coach: " +
            (error.response?.data?.error || "Unknown error")
        );
      }
    }
  }

  async function deleteCoach(id) {
    if (confirm("Are you sure you want to delete this coach?")) {
      try {
        const response = await api.delete(`/res/coaches/${id}/delete/`);

        if (response.status === 200) {
          alert("Coach deleted successfully!");
          loadCoaches();
        }
      } catch (error) {
        console.error("Error deleting coach:", error);
        alert(
          "Error deleting coach: " +
            (error.response?.data?.error || "Unknown error")
        );
      }
    }
  }

  // Statistics Functions
  async function loadStatistics() {
    try {
      const response = await api.get("/res/api/dashboard/stats/");
      const stats = response.data;

      // Create beautiful KPI cards
      document.getElementById("statsContent").innerHTML = `
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary shadow h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                  Total Revenue
                </div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">
                  $${(stats.total_revenue || 0).toLocaleString()}
                </div>
                <div class="text-xs text-success mt-1">
                  <i class="bi bi-arrow-up"></i> +12% from last month
                </div>
              </div>
              <div class="col-auto">
                <i class="bi bi-currency-dollar fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                  Total Users
                </div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">
                  ${(stats.total_users || 0).toLocaleString()}
                </div>
                <div class="text-xs text-success mt-1">
                  <i class="bi bi-arrow-up"></i> +8% from last month
                </div>
              </div>
              <div class="col-auto">
                <i class="bi bi-people fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-info shadow h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                  Total Reservations
                </div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">
                  ${(stats.total_reservations || 0).toLocaleString()}
                </div>
                <div class="text-xs text-info mt-1">
                  <i class="bi bi-calendar-check"></i> This month: ${Math.floor(
                    (stats.total_reservations || 0) * 0.3
                  )}
                </div>
              </div>
              <div class="col-auto">
                <i class="bi bi-calendar-event fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-warning shadow h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                  Tennis Courts
                </div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">
                  ${stats.total_terrains || 0}
                </div>
                <div class="text-xs text-warning mt-1">
                  <i class="bi bi-check-circle"></i> ${Math.floor(
                    (stats.total_terrains || 0) * 0.9
                  )} Available
                </div>
              </div>
              <div class="col-auto">
                <i class="bi bi-geo-alt fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;

      // Load performance metrics
      loadPerformanceMetrics(stats);

      // Initialize charts
      initializeCharts(stats);
    } catch (error) {
      console.error("Error loading statistics:", error);
      document.getElementById("statsContent").innerHTML = `
      <div class="col-12">
        <div class="alert alert-danger">
          <i class="bi bi-exclamation-triangle me-2"></i>
          Error loading statistics. Please try again.
        </div>
      </div>
    `;
    }
  }

  // Load performance metrics
  function loadPerformanceMetrics(stats) {
    const utilizationRate = Math.round(
      (((stats.total_reservations || 0) / (stats.total_terrains || 1)) * 100) /
        24
    );
    const revenuePerUser = Math.round(
      (stats.total_revenue || 0) / (stats.total_users || 1)
    );
    const avgReservationsPerCourt = Math.round(
      (stats.total_reservations || 0) / (stats.total_terrains || 1)
    );
    const coachUtilization =
      Math.round((stats.total_coaches || 0) * 0.7 * 100) / 100;

    document.getElementById("performanceMetrics").innerHTML = `
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="text-center">
        <div class="progress mb-2" style="height: 10px;">
          <div class="progress-bar bg-success" style="width: ${Math.min(
            utilizationRate,
            100
          )}%"></div>
        </div>
        <h6 class="mb-0">${utilizationRate}%</h6>
        <small class="text-muted">Court Utilization</small>
      </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="text-center">
        <div class="progress mb-2" style="height: 10px;">
          <div class="progress-bar bg-primary" style="width: ${Math.min(
            revenuePerUser / 10,
            100
          )}%"></div>
        </div>
        <h6 class="mb-0">$${revenuePerUser}</h6>
        <small class="text-muted">Revenue per User</small>
      </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="text-center">
        <div class="progress mb-2" style="height: 10px;">
          <div class="progress-bar bg-info" style="width: ${Math.min(
            avgReservationsPerCourt * 10,
            100
          )}%"></div>
        </div>
        <h6 class="mb-0">${avgReservationsPerCourt}</h6>
        <small class="text-muted">Avg Reservations/Court</small>
      </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="text-center">
        <div class="progress mb-2" style="height: 10px;">
          <div class="progress-bar bg-warning" style="width: ${Math.min(
            coachUtilization * 10,
            100
          )}%"></div>
        </div>
        <h6 class="mb-0">${coachUtilization}</h6>
        <small class="text-muted">Coach Utilization</small>
      </div>
    </div>
  `;
  }

  // Initialize Charts
  function initializeCharts(stats) {
    // Monthly Trend Chart
    const monthlyCtx = document
      .getElementById("monthlyTrendChart")
      .getContext("2d");
    new Chart(monthlyCtx, {
      type: "line",
      data: {
        labels: [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ],
        datasets: [
          {
            label: "Revenue ($)",
            data: generateMonthlyData(stats.total_revenue || 0),
            borderColor: "rgb(75, 192, 192)",
            backgroundColor: "rgba(75, 192, 192, 0.1)",
            tension: 0.4,
            yAxisID: "y",
          },
          {
            label: "Reservations",
            data: generateMonthlyData(stats.total_reservations || 0, 12),
            borderColor: "rgb(255, 99, 132)",
            backgroundColor: "rgba(255, 99, 132, 0.1)",
            tension: 0.4,
            yAxisID: "y1",
          },
        ],
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: "top",
          },
        },
        scales: {
          y: {
            type: "linear",
            display: true,
            position: "left",
          },
          y1: {
            type: "linear",
            display: true,
            position: "right",
            grid: {
              drawOnChartArea: false,
            },
          },
        },
      },
    });

    // User Roles Chart
    const rolesCtx = document.getElementById("rolesChart").getContext("2d");
    new Chart(rolesCtx, {
      type: "doughnut",
      data: {
        labels: ["Players", "Subscribers", "Coaches", "Admins"],
        datasets: [
          {
            data: [
              Math.floor((stats.total_users || 0) * 0.6),
              Math.floor((stats.total_users || 0) * 0.25),
              stats.total_coaches || 0,
              Math.floor((stats.total_users || 0) * 0.05),
            ],
            backgroundColor: ["#36A2EB", "#4BC0C0", "#FF9F40", "#FF6384"],
          },
        ],
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: "bottom",
          },
        },
      },
    });

    // Weekly Activity Chart
    const weeklyCtx = document
      .getElementById("weeklyActivityChart")
      .getContext("2d");
    new Chart(weeklyCtx, {
      type: "bar",
      data: {
        labels: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
        datasets: [
          {
            label: "Reservations",
            data: generateWeeklyData(stats.total_reservations || 0),
            backgroundColor: "rgba(54, 162, 235, 0.8)",
            borderColor: "rgba(54, 162, 235, 1)",
            borderWidth: 1,
          },
        ],
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            display: false,
          },
        },
        scales: {
          y: {
            beginAtZero: true,
          },
        },
      },
    });

    // Top Courts Chart
    const courtsCtx = document
      .getElementById("topCourtsChart")
      .getContext("2d");
    new Chart(courtsCtx, {
      type: "bar",
      data: {
        labels: ["Court A", "Court B", "Court C", "Court D", "Court E"],
        datasets: [
          {
            label: "Bookings",
            data: generateCourtData(stats.total_reservations || 0),
            backgroundColor: [
              "rgba(255, 99, 132, 0.8)",
              "rgba(54, 162, 235, 0.8)",
              "rgba(255, 205, 86, 0.8)",
              "rgba(75, 192, 192, 0.8)",
              "rgba(153, 102, 255, 0.8)",
            ],
          },
        ],
      },
      options: {
        indexAxis: "y",
        responsive: true,
        plugins: {
          legend: {
            display: false,
          },
        },
        scales: {
          x: {
            beginAtZero: true,
          },
        },
      },
    });
  }

  // Helper functions for generating sample data
  function generateMonthlyData(total, months = 12) {
    const data = [];
    for (let i = 0; i < months; i++) {
      data.push(Math.floor(Math.random() * (total / 6)) + total / 12);
    }
    return data;
  }

  function generateWeeklyData(total) {
    const data = [];
    for (let i = 0; i < 7; i++) {
      data.push(Math.floor(Math.random() * (total / 4)) + total / 14);
    }
    return data;
  }

  function generateCourtData(total) {
    const data = [];
    for (let i = 0; i < 5; i++) {
      data.push(Math.floor(Math.random() * (total / 3)) + total / 10);
    }
    return data.sort((a, b) => b - a);
  }

  // Refresh statistics
  function refreshStatistics() {
    loadStatistics();
  }

  // All Reservations Functions
  async function loadAllReservations() {
    try {
      // Load all reservations (this would need a new API endpoint)
      document.getElementById("reservationsContent").innerHTML = `
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">All Reservations</h5>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>User</th>
                  <th>Court</th>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="allReservationsTableBody">
                <tr>
                  <td colspan="7" class="text-center">Loading reservations...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    `;

      // This would load actual reservation data
      setTimeout(() => {
        document.getElementById("allReservationsTableBody").innerHTML = `
        <tr>
          <td colspan="7" class="text-center text-muted">
            Reservation management functionality ready for implementation.<br>
            <small>API endpoint needed: /res/api/all-reservations/</small>
          </td>
        </tr>
      `;
      }, 1000);
    } catch (error) {
      console.error("Error loading reservations:", error);
      document.getElementById("reservationsContent").innerHTML =
        '<div class="alert alert-danger">Error loading reservations</div>';
    }
  }

  // ==================== COACH SCHEDULE MANAGEMENT ====================

  function manageCoachSchedule(coachId, coachName) {
    document.getElementById("scheduleCoachId").value = coachId;
    document.getElementById("scheduleCoachName").textContent = coachName;

    // Load existing schedule
    loadCoachSchedule(coachId);

    const modal = new bootstrap.Modal(
      document.getElementById("coachScheduleModal")
    );
    modal.show();
  }

  async function loadCoachSchedule(coachId) {
    try {
      // Set date range for next 30 days
      const today = new Date();
      const endDate = new Date(today);
      endDate.setDate(today.getDate() + 30);

      const startDateStr = today.toISOString().split("T")[0];
      const endDateStr = endDate.toISOString().split("T")[0];

      // Load existing schedule from API
      const response = await api.get(
        `/res/api/coaches/${coachId}/schedule/?start_date=${startDateStr}&end_date=${endDateStr}`
      );

      if (response.status === 200) {
        const scheduleData = response.data;
        displayCoachSchedule(scheduleData.schedule_slots || []);
      }
    } catch (error) {
      console.error("Error loading coach schedule:", error);
      // Initialize empty schedule on error
      initializeEmptySchedule();
    }
  }

  function displayCoachSchedule(scheduleSlots) {
    // Clear existing schedule display
    const scheduleContainer = document.getElementById("coachScheduleList");

    if (scheduleSlots.length === 0) {
      scheduleContainer.innerHTML = `
        <div class="text-center text-muted py-4">
          <i class="bi bi-calendar-x" style="font-size: 2rem;"></i>
          <p class="mt-2">No schedule slots found</p>
        </div>
      `;
      return;
    }

    // Group slots by date
    const slotsByDate = {};
    scheduleSlots.forEach((slot) => {
      if (!slotsByDate[slot.date]) {
        slotsByDate[slot.date] = [];
      }
      slotsByDate[slot.date].push(slot);
    });

    // Generate HTML for schedule
    let scheduleHtml = "";
    Object.keys(slotsByDate)
      .sort()
      .forEach((date) => {
        const slots = slotsByDate[date];
        const dateObj = new Date(date);
        const dayName = dateObj.toLocaleDateString("en-US", {
          weekday: "long",
        });

        scheduleHtml += `
        <div class="card mb-3">
          <div class="card-header">
            <h6 class="mb-0">üìÖ ${dayName}, ${dateObj.toLocaleDateString()}</h6>
          </div>
          <div class="card-body">
            <div class="row">
              ${slots
                .map(
                  (slot) => `
                <div class="col-md-4 mb-2">
                  <div class="d-flex justify-content-between align-items-center p-2 border rounded ${
                    slot.is_booked ? "bg-light" : "bg-success bg-opacity-10"
                  }">
                    <span>
                      <i class="bi bi-clock me-1"></i>
                      ${slot.start_time} - ${slot.end_time}
                    </span>
                    <div>
                      <span class="badge ${
                        slot.is_booked ? "bg-secondary" : "bg-success"
                      } me-2">
                        ${slot.is_booked ? "Booked" : "Available"}
                      </span>
                      ${
                        !slot.is_booked
                          ? `
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteScheduleSlot(${slot.id})">
                          <i class="bi bi-trash"></i>
                        </button>
                      `
                          : ""
                      }
                    </div>
                  </div>
                </div>
              `
                )
                .join("")}
            </div>
          </div>
        </div>
      `;
      });

    scheduleContainer.innerHTML = scheduleHtml;
  }

  function initializeEmptySchedule() {
    const scheduleContainer = document.getElementById("coachScheduleList");
    scheduleContainer.innerHTML = `
      <div class="text-center text-muted py-4">
        <i class="bi bi-calendar-plus" style="font-size: 2rem;"></i>
        <p class="mt-2">No schedule found. Add time slots below.</p>
      </div>
    `;
  }

  function addTimeSlot(day) {
    const container = document.querySelector(`[data-day="${day}"]`);
    const slotId = Date.now(); // Simple unique ID

    const slotHtml = `
      <div class="time-slot mb-2 p-2 border rounded" data-slot-id="${slotId}">
        <div class="row align-items-center">
          <div class="col-4">
            <label class="form-label small">Start Time</label>
            <input type="time" class="form-control form-control-sm" name="start_time_${day}_${slotId}" required>
          </div>
          <div class="col-4">
            <label class="form-label small">End Time</label>
            <input type="time" class="form-control form-control-sm" name="end_time_${day}_${slotId}" required>
          </div>
          <div class="col-4">
            <button type="button" class="btn btn-sm btn-danger" onclick="removeTimeSlot(${slotId})">
              <i class="bi bi-trash"></i> Remove
            </button>
          </div>
        </div>
      </div>
    `;

    // Insert before the "Add Time Slot" button
    const addButton = container.querySelector(".btn-outline-primary");
    addButton.insertAdjacentHTML("beforebegin", slotHtml);
  }

  function removeTimeSlot(slotId) {
    const slot = document.querySelector(`[data-slot-id="${slotId}"]`);
    if (slot) {
      slot.remove();
    }
  }

  async function addNewScheduleSlot() {
    try {
      const coachId = document.getElementById("scheduleCoachId").value;
      const date = document.getElementById("newSlotDate").value;
      const startTime = document.getElementById("newSlotStartTime").value;
      const endTime = document.getElementById("newSlotEndTime").value;

      // Validate inputs
      if (!date || !startTime || !endTime) {
        alert("Please fill in all fields (Date, Start Time, End Time)");
        return;
      }

      if (startTime >= endTime) {
        alert("End time must be after start time");
        return;
      }

      // Validate date is not in the past
      const selectedDate = new Date(date);
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      if (selectedDate < today) {
        alert("Cannot create schedule slots in the past");
        return;
      }

      const scheduleData = {
        coach_id: coachId,
        date: date,
        start_time: startTime,
        end_time: endTime,
      };

      const response = await api.post(
        "/res/api/coach-schedule/create/",
        scheduleData
      );

      if (response.status === 201) {
        alert("‚úÖ Schedule slot created successfully!");

        // Clear form
        document.getElementById("newSlotDate").value = "";
        document.getElementById("newSlotStartTime").value = "";
        document.getElementById("newSlotEndTime").value = "";

        // Reload schedule
        loadCoachSchedule(coachId);
      }
    } catch (error) {
      console.error("Error creating schedule slot:", error);

      if (error.response?.status === 400) {
        alert("‚ùå " + (error.response?.data?.error || "Invalid data provided"));
      } else if (error.response?.status === 403) {
        alert("‚ùå Permission denied. Admin access required.");
      } else {
        alert(
          "‚ùå Error creating schedule slot: " +
            (error.response?.data?.error || "Unknown error")
        );
      }
    }
  }

  async function deleteScheduleSlot(slotId) {
    if (!confirm("Are you sure you want to delete this schedule slot?")) {
      return;
    }

    try {
      const response = await api.delete(
        `/res/api/schedule-slots/${slotId}/delete/`
      );

      if (response.status === 200) {
        alert("‚úÖ Schedule slot deleted successfully!");

        // Reload schedule
        const coachId = document.getElementById("scheduleCoachId").value;
        loadCoachSchedule(coachId);
      }
    } catch (error) {
      console.error("Error deleting schedule slot:", error);

      if (error.response?.status === 400) {
        alert(
          "‚ùå " + (error.response?.data?.error || "Cannot delete booked slots")
        );
      } else if (error.response?.status === 403) {
        alert("‚ùå Permission denied. Admin access required.");
      } else if (error.response?.status === 404) {
        alert("‚ùå Schedule slot not found.");
      } else {
        alert(
          "‚ùå Error deleting schedule slot: " +
            (error.response?.data?.error || "Unknown error")
        );
      }
    }
  }

  // Initialize
  document.addEventListener("DOMContentLoaded", function () {
    loadDashboardData();
  });
</script>

{% endblock %}
